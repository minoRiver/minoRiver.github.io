---
layout: single
title:  "[유니티 그래픽스 최적화 스타트업 정리] SRP"
author_profile: false
tag : [유니티 최적화]
categories : 유니티 최적화
typora-root-url: ../
---

> ## 개요

이 글은 "[유니티 그래픽스 최적화 스타트업](https://product.kyobobook.co.kr/detail/S000001888125)"이라는 책을 보고 정리한 글입니다.

오늘은 유니티에서 기존의 빌트인 렌더 파이프라인의 대안으로 발표한 SRP에 대해 조사하고 정리했습니다.



> ## SRP(Scriptable Render Pipeline)란?

SRP는 Unity에서 발표한 렌더 파이프라인으로 C# 스크립트를 통해 렌더링을 제어 및 맞춤 설정할 수 있는 렌더 파이프라인입니다.

기존의 빌트 인 렌더 파이프라인의 경우 어떤 방식으로 진행되는지 모르는 블랙박스 같은 렌더 파이프라인이였지만, SRP가 나오면서 투명한 파이프라인이 됐습니다. SRP를 사용해 새로운 렌더링 기술을 직접 적용하거나, 특정 하드웨어에 맞게 최적화하는 등 프로그래머가 커스터마이징하여 직접 파이프라인을 구성할 수 있습니다. 여기서 말하는 렌더링 루프란 GPU의 렌더 파이프라인뿐만 아니라, 어플리케이션 단계까지 모두 포함한 개념입니다. 즉 컬링, 렌더 패스 등 모든 렌더 파이프라인 절차를 커스터마이징할 수 있다고 말할 수 있습니다.

유니티의 로우 레벨 렌더링 파트는 C++로 구현되어 있지만, SRP는 C# 스크립트로 사용하고 제어할 수 있도록 구현되어 있습니다.



> ## HDRP(High Definition Render Pipeline)

HDRP는 하이엔드 PC나 콘솔 등을 고려해서 고품질의 비주얼을 구현하는데 적합한 파이프라인으로 유니티의 빌트인 파이프라인에 구현되어 있는 디퍼드나 포워드 렌더링 방식보다 발전되고 개선된 렌더링 기법이 적용되어 있습니다. 고품질의 렌더링에 초점이 맞춰져 있기 때문에 기본적으로 높은 하드웨어 스펙을 요구하며, 이 때문에 데스크톱이나 콘솔에 비해 성능이 낮은 모바일 게임 개발용으로는 적합하지 않습니다.



> ## LWRP(Lightweight Render Pipeline)

LWRP는 퍼포먼스에 최적화되어 있어 모바일이나 VR, AR처럼 성능에 민감한 환경에서 높은 성능을 보여주는 파이프라인입니다. 기존 파이프라인에 비해 성능을 위한 특징들이 존재하며, 이를 통해서 라이팅과 쉐이딩 관련한 단점들을 해결하여 성능 제약이 있는 플랫폼에서 최적화된 실시간 렌더링 퍼포먼스를 제공합니다.

<br>

##### 멀티 라이트 싱글 패스(Multi Light Single Pass)

LWRP의 가장 큰 특징으로는 실시간 라이팅들이 싱글 패스로 처리된다는 점입니다. 기존 파이프라인에서 포워드 렌더링의 경우 실시간 라이트 여러 개를 처리하기 위해 그 만큼 드로우콜이 늘어납니다. 하지만 LWRP에서는 오브젝트를 렌더링할 때 오브젝트에 영향받는 동적 라이트들을 쉐이더에 전달해 한 번의 드로우콜로 여러 개의 라이트들을 모두 처리해줍니다. 또한, 그러한 연산을 진행할 수 있도록 경량화된 별도의 스탠다드 쉐이더를 제공합니다.

LWRP의 스탠다드 쉐이더는 두 개의 타입이 존재합니다. Physically Based와 Simple Lighting 입니다.

<br>

Physically Based 쉐이더는 물리 기반의 라이팅 연산을 거칩니다. 즉, PBS(Physically Based Shader)에 제대로 대응하는 쉐이더입니다.

<br>

Simple Lighting 쉐이더는 pyhsically Based 쉐이더에 비해 품질이 떨어지는 대신 성능을 절약할 수 있는 쉐이더입니다. 기존의 레거시 mobile/Lit 쉐이더를 대체한다고 볼 수 있습니다. pyhsically Based와는 달리 에너지 보존 법칙을 따르지 않으며, 저사양 기기를 타겟으로 잡았을 때 사용하기 적당한 쉐이더입니다.

<br>

##### 성능을 고려한 제약 사항들

기존의 빌트인 렌더 파이프라인은 범용적으로 만들어져 있기 때문에 게임에 적용할 수 있는 다양한 기술이 구현되어 있지만 그만큼 성능에 영향을 줄 수 있는 많은 옵션들이 있습니다. 그렇기 때문에 개발 과정에서 실수할 여지가 많이 생깁니다. 예를 들어, 모바일 게임에서 실시간 GI는 성능에 큰 부담을 주지만 활성화시키는 데는 아무런 제동 장치가 없습니다.  그렇기 때문에 누군가의 실수로 인해 켜질 경우 성능에 막대한 영향을 줄 수 있습니다.

LWRP는 성능에 민감한 기능들을 의도적으로 제한을 두어, 실수로 인해 성능에 악영향을 미치는 경우를 최소화시킬 수 있게 구현되어 있습니다.

대표적으로 실시간 GI, 실시간 쉐도우, 라이트 모드가 있습니다.

실시간 GI의 경우 LWRP에는 사용을 못하도록 제거되어 있습니다. 그리고 실시간 쉐도우의 경우 오로지 하나의 라이트에서만 작동하도록 구현되어 있습니다. 마지막으로 BakedIndirect 와 Shadowmask 모드를 지원하지 않습니다.

