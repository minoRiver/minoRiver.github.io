---
layout: single
title:  "[유니티 그래픽스 최적화 스타트업 정리] 유니티 빛(라이트)"
author_profile: false
tag : [유니티 유니티최적화]
categories : 유니티 유니티최적화
typora-root-url: ../
---

> ## 개요

이 글은 "[유니티 그래픽스 최적화 스타트업](https://product.kyobobook.co.kr/detail/S000001888125)"이라는 책을 보고 정리한 글입니다.

빛은 게임의 분위기나 리얼함을 살리기 위해 필요한 요소라 생각합니다. 유니티에서는 빛과 관련된 여러 다양한 기능들을 제공하고 있습니다. 오늘은 유니티에서 제공하는 기능 중 하나인 빛에 대해 조사해 정리했습니다.



> ## 라이트의 종류

#### Point Light

Point Light는 공간의 한 점에서부터 광원을 모든 방향으로 균등하게 내보

<br>

#### Directional Light



<br>

#### Spot Light



> ## 라이트 모드

![image-20230710190726970](/images/2023-07-10-sixth/image-20230710190726970.png)

유니티의 라이트에는 3가지 모드가 있습니다.

<br>

#### Baked 모드

이 모드인 라이트는 미리 연산되어 저장됩니다. 이 과정을 베이킹(Baking)이라 표현하는데 베이킹 과정으로 라이트를 미리 연산하여 라이트맵이나 라이트 프로브로 저장하게 되면 런타임 상에서 라이팅 연산을 하지 않기 때문에 런타임 성능을 절약할 수 있습니다. 대신 동적으로 움직이는 물체에는 적용할 수 없습니다.

<br>

#### Realtime 모드

말 그대로 실시간으로 연산되는 라이트입니다. 런타임에 생성이 가능하며 캐릭터 같은 동적 오브젝트들에 대응하여 실시간으로 빛 연산을 적용할 수 있다. 하지만 매 프레임마다 업데이트가 이뤄지기 때문에 성능에 가장 큰 영향을 미치는 모드입니다.

<br>

#### Mixed 모드

Baked와 Realtime 모드가 혼합된 모드입니다. 라이트 맵이나 라이트 프로브에도 대응하고 동적인 오브젝트에도 대응합니다.



> ## 오브젝트에 여러 개의 동적 라이트가 적용되는 과정

아래와 같이 Directional Light 3개를 배치했을 때 빛이 적용되는 과정을 통해 왜 드로우콜이 여러 번 발생하는지 알아봤습니다.

![image-20230710193747457](/images/2023-07-10-sixth/image-20230710193747457.png)

<br>

먼저 가장 밝은, 즉 세기(Intensity)가 제일 높은 라이트가 메인 라이트가 되어 오브젝트에 적용하기 위해 렌더링합니다.

![image-20230710194115994](/images/2023-07-10-sixth/image-20230710194115994.png)

<br>

그 다음으로 밝은 라이트가 적용됩니다.

![image-20230710194215736](/images/2023-07-10-sixth/image-20230710194215736.png)

<br>

마지막으로 남은 라이트가 적용되면 최종 구체의 색이 완성됩니다.

![image-20230710194253547](/images/2023-07-10-sixth/image-20230710194253547.png)



방금 과정에서 보면 알 수 있듯이 3개의 라이트에 대해 렌더링하는 과정으로 인해 3개의 드로우콜이 발생했습니다. 유니티에서 확인해보니 4개의 드로우콜이 발생했습니다.(Sphere 1, Light 3)

![asdasdasdasdas](/images/2023-07-10-sixth/asdasdasdasdas.png)

이런 방식으로 라이팅 연산을 할 경우 오브젝트의 개수가 10개만 되더라도 총 44개의 드로우콜이 발생합니다. 그렇기 때문에 Realtime 모드의 라이트를 추가한다는 것은 성능에 큰 부담이 될 수 있습니다. 라이트의 렌더 모드를 수정해 성능 부담을 줄일 수 있습니다.

그리고 Point Light와 Spot Light의 경우 Directional Light와는 다르게 빛이 적용되는 범위가 있습니다. 만약 오브젝트가 영향 범위 안에 없는 경우, 오브젝트를 렌더링할 때 해당 라이트를 적용하지 않기 때문에 드로우콜이 발생하지 않습니다.



> ## 라이트의 렌더 모드(Render Mode)

렌더 모드에는 Auto, Important, Not Important 3 개의 모드가 있습니다.

<br>

#### Important

해당 라이트가 중요하다고 설정합니다. 이 렌더 모드가 적용된 라이트는 항상 per-pixel(빛셀마다 연산함)로 연산됩니다. 픽셀마다 연산된다는 것은 스페큘러 처리 및 노멀맵 대응이 가능하다는 의미가 됩니다. 하지만, 성능상 부담이 되기 때문에 시각적으로 정말 중요한 라이트만 렌더 모드를 Important로 설정해야 합니다.

<br>

#### Not Important

해당 라이트가 중요하지 않다고 설정합니다. 이렇게 되면 이 라이트는 per-vertex(버텍스마다 연산) 처리되거나 스피리컬 하모니스(SH, 구면조화함수)를 활용합니다. Important로 설정된 라이트보다 품질이 떨어지고 스페큘러에 대응할 수 없게 되지만 성능 부담이 적어집니다.

하나의 라이트만 Important로 설정하고 나머지 라이트들을 Not Important로 설정하면, 한 번의 드로우콜로 처리가 가능해집니다.



#### Auto

라이트를 생성하면 Default 값이 Auto로 설정되어 있습니다. 라이트들의 밝기에 따라서 중요한 라이트와 중요하지 않은 라이트를 자동 분류해줍니다. 분류 시 퀄리티 세팅에 의존하며 Edit > Project Settings > Quality 를 선택하여 퀄리티 세팅을 할 수 있습니다.

![image-20230710200116824](/images/2023-07-10-sixth/image-20230710200116824.png)

기본적으로 메인 Directional Light 1개가 per-pixel 로 처리될 수 있고, Pixel Light Count에 설정된 개수만큼 추가적으로 처리될 수 있습니다. 예를 들어서 Pixel Light Count 가 4로 설정되어 있다면, 실시간으로 per-pixel 로 처리될 수 있는 라이트는 사실상 5개가 되는 것입니다.(메인 Directional Light + 그 외 4개의 라이트)
