---
layout: single
title:  "[유니티 그래픽스 최적화 스타트업 정리] 리플렉션 프로브"
author_profile: false
tag : [유니티 최적화]
categories : 유니티 최적화
typora-root-url: ../
---

> ## 개요

이 글은 "[유니티 그래픽스 최적화 스타트업](https://product.kyobobook.co.kr/detail/S000001888125)"이라는 책을 보고 정리한 글입니다.

오늘은 리플렉션 라이트에 대해 조사하고 정리했습니다.



> ## 리플렉션, 빛의 디퓨즈(Diffuse)와 스페큘러(Specular)

물리 기반 쉐이더의 중요한 요소 중 하나는 바로 에너지 보존 법칙입니다. 이 법칙은 빛에도 마찬가지로 적용됩니다. 어떤 오브젝트의 표면에 빛이 닿으면 일부는 오브젝트의 표면에 흡수되었다가 산란되어 발산됩니다. 또 다른 일부는 흡수되지 않고 바로 반사됩니다. 발산되는 양과 반사되는 양의 합은 원래 들어오는 빛의 양을 넘을 수 없다는 것이 그래픽스 라이팅에서의 에너지 보존 법칙입니다.

![image-20230712165044953](/images/2023-07-12-fourth/image-20230712165044953.png)

​																														<[이미지 출처](https://blog.selfshadow.com/publications/s2013-shading-course/hoffman/s2013_pbs_physics_math_slides.pdf)>

<br>

이 때 반사되는 라이트를 스페큘러, 발산되는 라이트를 디퓨즈라고 부릅니다.

![image-20230712165128322](/images/2023-07-12-fourth/image-20230712165128322.png)

​																														<[이미지 출처](https://blog.selfshadow.com/publications/s2013-shading-course/hoffman/s2013_pbs_physics_math_slides.pdf)>

<br>

또한, 표면이 매끄러울수록 반사가 선명하게 일어나고 거칠수록 반사가 분산됩니다.

![image-20230712165325486](/images/2023-07-12-fourth/image-20230712165325486.png)

​																														<[이미지 출처](https://blog.selfshadow.com/publications/s2013-shading-course/hoffman/s2013_pbs_physics_math_slides.pdf)>

<br>

이러한 반사(Reflection)는 물리 기반 쉐이더에서 라이팅을 표현할 때 중요한 요소입니다. 특히, 금속 재질의 특성이 강한 머티리얼일수록 중요해집니다.

유니티의 경우 물리 기반 쉐이더에서 이러한 라이팅의 디퓨즈, 스페큘러 및 반사 같은 기능들이 구현되어 있어 금속 재질 등을 렌더링할 수 있지만, 복잡한 씬을 만들 경우 이질감이 생길 수 있습니다. 그 이유는 주변 환경을 반사하지 못하기 때문입니다. 리플렉션 프로브는 이러한 문제를 해결할 때 사용할 수 있습니다.



> ## 리플렉션 프로브(Reflection Probe)란?

리플렉션 프로브는 주변 환경을 반사하는 자연스러운 반사 이미지를 만들어 냅니다. 오브젝트가 리플렉션 프로브 영역에 들어오면 반사 이미지를 리플렉션 프로브에 저장된 이미지로 대체하여 자연스러운 반사 이미지를 만들어 내는 것입니다.



아래 두 사진은 리플렉션 프로브를 적용하지 않은 것과 적용한 것입니다. 보시면 리플렉션 프로브를 적용한 사진은 오브젝트에 주변 환경이 반사되는 것을 확인할 수 있습니다.

![image-20230712175032367](/images/2023-07-12-fourth/image-20230712175032367.png)

![image-20230712175047679](/images/2023-07-12-fourth/image-20230712175047679.png)

<br>

리플렉션 프로브의 위치를 좀 더 알기 쉽게 하기 위해 해당 위치에 조명을 배치했습니다.

![image-20230712175212126](/images/2023-07-12-fourth/image-20230712175212126.png)



> ## 리플렉션 프로브 사용 시 유의할 점

리플렉션 프로브로 캡처된 이미지는 큐브맵 형태로 저장됩니다. 큐브맵은 텍스처이기 때문에 메모리 이슈가 발생할 수 있습니다. 

리플렉션 프로브 컴포넌트에서 Resolution 항목을 통해 해상도를 설정할 수 있는데 여기서 말하는 해상도란 큐브맵 텍스처 중 한 장의 사이즈를 말합니다. 큐브맵은 말 그대로 큐브 형태의 텍스처 즉, 6개의 텍스처가 육면체로 이루어진 텍스처를 말합니다. 그렇기 때문에 큐브맵 텍스처의 크기는 일반적인 텍스처의 6배 크기를 차지합니다. 만약 리플렉션 프로브 Resolution 을 128에서 256으로 늘릴 경우 (256 * 256 - 128 * 128) * 6 = 294,912 텍셀이 늘어납니다. 그래서 리플렉션 프로브의 해상도는 가급적 작게 설정하는 것이 좋습니다.

![image-20230712175445528](/images/2023-07-12-fourth/image-20230712175445528.png)
